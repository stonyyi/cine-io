response = ["1f8b0800fa748f5402ffec9ccb6edcc815865fc5d03a24ceadaa4ef536d9cc20abc0b3711004c5ba4ce4d8922169020c8c79f714dd6693b4db223d6e5a92d59256ad9f2cf27c752e75ebf71737f9f6b7377717bb7fbebfb8b9be7e7bb17b71618473c9a56060628100100a52ea9ad0c58bbfbcb8b8cdb7b797d757bffcf2d3df7a39b220aac3c6295023c9c42660088de49cc194d219cffd65ef6eae5fe778f753baaf8d5e7899f2d5dde5ddef83525d470631a6021eb42a994b865ef9df9cafaae6fdc5dde5db7c7b17debeebaf204069901ae497403be09dd8969d7dd55f116f72b8cbe9dfe16e497939b4def9ace4214b97a4749432a88f177f54498877d50ebdecb7db7cf3f3f5e5554effe88d387989febf2fff73fd36dcf697fcb046763bc19699978d3c534e8c5c6cf2d6394ece74a228ce952346fe7b2e771b9938538824263728051b91189a903434194ad1445d32101ed0c4a83b76adc0723f9e2b4713072cc9782f3eb8501fa53228e183896f2f7fbd0a6f2eaf7efdeb9bcbfac8bd3ed6be7c79ddbccbf9a6797dfbe27ff9a63755032db478f17dbbfee3e762682d978972c285200ef1c5a35a058ca7e172126f795d7f8e6021b442595d43416d8d48d0354a5a1a29b9cb119c43fdba88b4d6d8ae45c455c61e955363231e9c802895ecc26230ff5a104fd0b07e075ac3b25936ec4c39336c145baa5d39fbe2a243631702f836663d1e45baeadaa53a587d0b9046c0fba64be41a2ebe3a5e506530a7b4aa79896ec776677c0b86eeb3ea11e5c1aa052377d651b6d1b960b32b12cd07ab2eb4aaad9a7dd7fffefdfa3b01385918df1bcdedc0b606dc32aa99728a4a68882c5a6a48279ffe6c185f7c5066fb6aa3781fbcf54c3e924a725dad7829478b391352a108946a7482541cc7a04990b814011373c45abf117447d82757a213cb4d80e21a31be345eb07605efa098e239a56f64af2e42ce9e14fa5fc83e63a76bd90bf60593f16691fd5c39619f0c0ec1afef7f9de7b201fb7df302faea6b6ab09fab116ff2ef2bf13b60753e5a36d4996caab3328274257ac55aa814741da690b5ebea3fd05915cf92c970501f4ace4fcff5ab550db456780dfe8972863f0fae1f8aa74a286e83bf362f4e5e6d56826f40fff13bbf91d6b0aea23f2aa7f42d25ca2104c996d9a98fb0117d69d9d2d372fe478d5f6b2eedd329902ce0ff5439e227863c9468aecb1dc67cfabcbf6fdeb47434f67f29ef7f1dfce215d8779d4f566a3e63455b8c04aee3eeda0b3c181b12609110d9649712384c6a11c1a8adb5697c9af07d5b5f7515fc5139858f384c5ba5ae0e8244f246f07dcb6437f4fd0df03feac4ffc1aa882da35f837fa29ce1e7716ab84681faa0dbe0afcd0f93199b24fe67e9fc24b5988335f427ca297d8221f1bb5a0042b4b40dfddabc98ed22ff731bf2ed6deada5aebac823f2a67f07988fcd55a9135c146f05deb4036836f4c1dd064afc6668be4818d47083db110955c35336b761888bc0da58e704b8d1288e20c78b1311d831f4c2826d82692a74698a109b5706d121787506a3ff0f4b0f0d9b66c700dfc8972063f1e067c900278dcc8f36bf36861c3b4bf01fec79ff6d9b5acba0affa89ce11f172b0d70c28e37c2ef5af4bc5dda7f86ceaf3b32ad65b34c7fa69cd2f7fe403fd74751d22de87f68bea2784a03be47eefaa68ea3a89515697fae9cc0cf918699de18bb94957103f8fbe6ab036d35cbfffcc2fe47a22a6bd9ab1c613f6ea0085963074f91fd739be21f899ad5eccd11f6c358cf381bad986e43f6b815fba710f39789fa7e1b42ad8dac2e2dad7faa1c89b2881f88aac4c890e5fea5f5e15e06e08196d69f82e77e0d3db79a9e3b426f88c55e6270ae5b494f56d4d3dbd07b0a39772d3d6deb47abe88dca19bd70582fb7d0b198b4d6f71e6a5bcb33ab96097650ffb855b2f773fe4c39e19ce2617e3c74cebb20eed459f3d0bc183c574ca766ef57b3f7f7b0af51ccb055bb1d7bf1e791d289d92fad8c7ca69cb33fec85b3946a64d00dfdfe598f949689e28efc4ea8b56621637fa61c891a8a765ce88e54cd707fc63edc4b2c9c33f649e8e96a7a7a84dec11f31e754fbed5a7a78ae964f41cfc35a7a1e8ed01baae57e7b5104356be99dc73adf276bd28e61676c6b9696953e538e9caba1e0b09b240397644ebe8bf8d0bcc0b95a3e29fb7e93c03af6a372c61ec74da442853bda8c3d7bff9ce717b760ef692dfb4139673fc6f70409c93e45bfff31eaad6a28ec0f6319cbcb4467ca29515306a2b5795f6af9757fc61eeec52ae78c7d127ab29a9edc432f3a6b917d7aecf47e8c91eac84457d3d323f40e7bb342b6d911aea5c7677adf444f60275a2b5bb7486fae9cd0630793a35499722a4bf4f6f762a7e7c8f9cdf47c8b6456d11b95337a872ad6fb2c8e3a5c49cfcb7996e804f42cc94a7af6b3934c3dbd61fce9d87a215a4d8fcef4bed378437cbf29d8c80a2f9d29279c8dc2a43a0d5ef316e38d7df3b51f9d57664ecddeaf66ef8fb01ff26bb412eb1bc6edd83b38cf313d2ef6437696ec3a17306de8f77a9e67b88f28ef1077842d2eaeeb7caa9c100dde4f668c8d7501eecfd8fb7b41eb1f6c5de7c718eb1c98585c4bcfe2317a1fd754637d5449b9aca427e7759d6fa7472de03a7aa372462f8c07009d536f78adef9de719be4fd6ac16b73bd4b6becb32e79972c2b91b4f7c8448ea6c77faacb96fde7dc1b1cfd5f203b21ff2ab060c8ac56cc8de9c57e54ecbde385ac97e507ec1ef013a573c6fc85eb6629f7332e42ae590b38bb144625055573f2dca3e5b889e150281818ce4d858354eb0863ab0269523ec63d6102399868d72d37f5b65a3b9b2171fbb92c95a6bfc431df1dc9b54b485c579cc4f9553f61926abf1122ce46dd88b6b4979c3f3dd1be0cfa13045e4c6bb921ac9a56b3aced4546ca41ea898e21ed6f50dd7725bd6e09f2867f8cde47c77894636c26fa8f5bae1f7b93d3fe727e8bf30c3a85fa43f574ee8c79a283f26fda8de05aa2f747afafbe60560b3f3ddcfcff5ab4d995a06bb06fe4439851f613ce3dba921e46de0d7e691fecc1cd9bffef83f000000ffff","030022d6d194b7610000"]
qs = require('qs')

module.exports = (projectId, month)->
  firstSecondInMonth = new Date(month.getFullYear(), month.getMonth(), 1)
  lastSecondInMonth = new Date(month.getFullYear(), month.getMonth() + 1)
  lastSecondInMonth.setSeconds(-1)

  filters =
    [
      {
        property_name: "projectId"
        operator: "eq"
        property_value: projectId
      }
    ]
  timeframe =
    start: firstSecondInMonth.toISOString()
    end: lastSecondInMonth.toISOString()
  query =
    event_collection: 'peer-reporting'
    filters: JSON.stringify(filters)
    timeframe: JSON.stringify(timeframe)

  path = "/3.0/projects/548b844ac2266c05648b501e/queries/extraction?#{qs.stringify(query)}"

  nock('https://api.keen.io:443')
    .get(path)
    .reply(200, response, { server: 'nginx',
    date: 'Mon, 15 Dec 2014 23:55:38 GMT',
    'content-type': 'application/json',
    'transfer-encoding': 'chunked',
    connection: 'close',
    expires: 'Sat, 01 Jan 2000 01:01:01 GMT',
    vary: 'Accept-Encoding',
    pragma: 'no-cache',
    'cache-control': 'private, no-cache, no-cache=Set-Cookie, max-age=0, s-maxage=0',
    'access-control-allow-origin': '*',
    'access-control-allow-headers': 'origin, content-type, accept, authorization, user-agent',
    'content-encoding': 'gzip' })
